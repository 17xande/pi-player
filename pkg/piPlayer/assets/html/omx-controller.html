<template>
  <p>This is the CONTROLLER!! Whoop Whoop!</p>
  <h1>Is this actually working</h1>
</template>

<script>
  // get this html document:
  const thisDoc = document.currentScript.ownerDocument;
  const template = thisDoc.querySelector('template').content;

  // create an object based on the HTML Element prototype
  let el = Object.create(HTMLElement.prototype);

  // fires when an instance of the element is created
  el.createCallback = function() {
    // creates the shadow root
    let shadowRoot = this.createShadowRoot();

    // add a template clone into shadow root
    let clone = document.importNode(template, true);
    shadowRoot.appendChild(clone);
    
    // cache this shadowRoot
    this.shadowRoot = shadowRoot;
  };

  // fires when an attribute was added, removed, or updated
  el.attributeChangedCallback = function(attr, oldVal, newVal) {
    // s = `attr: ${attr}\noldVal: ${oldVal}\nnewVal: ${newVal}`;
    // this.update(s);
  };

  el.update = function(val) {
    let p = this.shadowRoot.querySelector('p');
    p.textContent = val;
  };

  // registers <control> in the main document
  window.MyElement = document.registerElement('omx-controller', {
    prototype: el
  });
</script>